<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Facets • ggh4x</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Facets">
<meta property="og:description" content="ggh4x">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ggh4x</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Facets.html">Facets</a>
    </li>
    <li>
      <a href="../articles/PositionGuides.html">Position Guides</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/teunbrand/ggh4x/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Facets</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/teunbrand/ggh4x/blob/master/vignettes/Facets.Rmd"><code>vignettes/Facets.Rmd</code></a></small>
      <div class="hidden name"><code>Facets.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggh4x</span>)
<span class="co">#&gt; Loading required package: ggplot2</span></pre></body></html></div>
<p>The ggh4x package has some extended options for tweaking the appearance of facets.</p>
<div id="nested-facets" class="section level1">
<h1 class="hasAnchor">
<a href="#nested-facets" class="anchor"></a>Nested facets</h1>
<p>Perhaps this package might be best known for generating nested facets; wherein outer strips can span inner strips if they belong the the same category. This can be especially useful if there is some hierarchical relations to the facets.</p>
<p>In the example below, we’ll categorise the Iris species for having long or short leaves.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(
  <span class="no">iris</span>,
  <span class="kw">Nester</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">iris</span>$<span class="no">Species</span> <span class="kw">==</span> <span class="st">"setosa"</span>, <span class="st">"Short Leaves"</span>, <span class="st">"Long Leaves"</span>)
)

<span class="fu">ggplot</span>(<span class="no">df</span>, <span class="fu">aes</span>(<span class="no">Sepal.Width</span>, <span class="no">Sepal.Length</span>)) +
  <span class="fu">geom_point</span>() +
  <span class="fu"><a href="../reference/facet_nested.html">facet_nested</a></span>(~ <span class="no">Nester</span> + <span class="no">Species</span>)</pre></body></html></div>
<p><img src="Facets_files/figure-html/unnamed-chunk-2-1.png" width="480"></p>
<p>If you prefer your strips to have blank backgrounds, you could still indicate the hierarchical nature by setting <code>nest_line = TRUE</code>. The appearance of the line is controlled by the theme element <code>ggh4x.facet.nestline</code>.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu">ggplot</span>(<span class="no">df</span>, <span class="fu">aes</span>(<span class="no">Sepal.Width</span>, <span class="no">Sepal.Length</span>)) +
  <span class="fu">geom_point</span>() +
  <span class="fu"><a href="../reference/facet_nested.html">facet_nested</a></span>(~ <span class="no">Nester</span> + <span class="no">Species</span>, <span class="kw">nest_line</span> <span class="kw">=</span> <span class="fl">TRUE</span>) +
  <span class="fu">theme</span>(<span class="kw">strip.background</span> <span class="kw">=</span> <span class="fu">element_blank</span>(),
        <span class="kw">ggh4x.facet.nestline</span> <span class="kw">=</span> <span class="fu">element_line</span>(<span class="kw">colour</span> <span class="kw">=</span> <span class="st">"blue"</span>))</pre></body></html></div>
<p><img src="Facets_files/figure-html/unnamed-chunk-3-1.png" width="480"></p>
<p>While <code><a href="../reference/facet_nested.html">facet_nested()</a></code> is based on <code>facet_grid()</code>, there are a few differences. Notably, <code><a href="../reference/facet_nested.html">facet_nested()</a></code> doesn’t require input data to have <em>all</em> the facet variables. In the example below, we remove the <code>Species</code> column, to prevent facetting on that variable. Note that if we didn’t specify a new <code>Nester</code> variable, it would put the second set of points in all panels, just like <code>facet_grid()</code>.</p>
<p>Furthermore, when strips are placed at the bottom, it rearranges the strips so that the inner strips are closest to the panels and spanning strips are furthest from the panel.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu">ggplot</span>(<span class="no">df</span>, <span class="fu">aes</span>(<span class="no">Sepal.Width</span>, <span class="no">Sepal.Length</span>)) +
  <span class="fu">geom_point</span>() +
  <span class="fu">geom_point</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html">transform</a></span>(<span class="no">iris</span>, <span class="kw">Species</span> <span class="kw">=</span> <span class="kw">NULL</span>, <span class="kw">Nester</span> <span class="kw">=</span> <span class="st">"All"</span>)) +
  <span class="fu"><a href="../reference/facet_nested.html">facet_nested</a></span>(~ <span class="no">Nester</span> + <span class="no">Species</span>, <span class="kw">switch</span> <span class="kw">=</span> <span class="st">"x"</span>)</pre></body></html></div>
<p><img src="Facets_files/figure-html/unnamed-chunk-4-1.png" width="480"></p>
</div>
<div id="position-scales" class="section level1">
<h1 class="hasAnchor">
<a href="#position-scales" class="anchor"></a>Position scales</h1>
<p>A second thing we might want to tweak about facets is the exact specifications of each facet’s position scale. To set the scales individually, we can use <code><a href="../reference/facetted_pos_scales.html">facetted_pos_scales()</a></code> in combination with a list of scales. This way, you can vary labels, breaks, limits, transformations and even axis guides for each panel individually.</p>
<p>The list of scales follows the order of the facets, as long as they are set to ‘free’. Tweaking the position scales works with many types of facets, such as wrap, grid and nested, but has to be called <em>after</em> facets are added.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">scales</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
  <span class="fu">scale_x_reverse</span>(),
  <span class="fu">scale_x_continuous</span>(<span class="kw">labels</span> <span class="kw">=</span> <span class="kw pkg">scales</span><span class="kw ns">::</span><span class="no"><a href="https://scales.r-lib.org//reference/label_dollar.html">dollar</a></span>,
                     <span class="kw">minor_breaks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2.5</span>, <span class="fl">4.5</span>)),
  <span class="fu">scale_x_continuous</span>(<span class="kw">breaks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2.945</span>, <span class="fl">6</span>),
                     <span class="kw">limits</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">10</span>),
                     <span class="kw">guide</span> <span class="kw">=</span> <span class="st">"axis_minor"</span>)
)

<span class="fu">ggplot</span>(<span class="no">mpg</span>, <span class="fu">aes</span>(<span class="no">displ</span>, <span class="no">hwy</span>)) +
  <span class="fu">geom_point</span>() +
  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(<span class="no">drv</span>), <span class="kw">scales</span> <span class="kw">=</span> <span class="st">"free_x"</span>) +
  <span class="fu"><a href="../reference/facetted_pos_scales.html">facetted_pos_scales</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">scales</span>)</pre></body></html></div>
<p><img src="Facets_files/figure-html/unnamed-chunk-5-1.png" width="480"></p>
<p>This works because <code><a href="../reference/facetted_pos_scales.html">facetted_pos_scales()</a></code> makes an edit to the facet, which comes with an important limitation. Due to the way plots are build and where facets are involved, scale transformations are applied <em>after</em> calculations in the stat part of the layer. This differs from normal behaviour, where scale transformations are applied <em>before</em> stat calculations. Therefore, it is recommended to pre-transform the data in layers with non-identity statistics in the <code>aes()</code> mapping. An example of what could go wrong is shown below.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">0</span>)
<span class="no">df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
  <span class="kw">x</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html">rlnorm</a></span>(<span class="fl">100</span>, <span class="fl">10</span>)
)

<span class="co"># Normally data is transformed prior to stat calculations</span>
<span class="fu">ggplot</span>(<span class="no">df</span>, <span class="fu">aes</span>(<span class="no">x</span>)) +
  <span class="fu">geom_density</span>() +
  <span class="fu">scale_x_log10</span>()

<span class="co"># This can give problems when combining stat calculations with facetted </span>
<span class="co"># position scale transformations.</span>
<span class="fu">ggplot</span>(<span class="no">df</span>, <span class="fu">aes</span>(<span class="no">x</span>)) +
  <span class="fu">geom_density</span>() +
  <span class="fu"><a href="../reference/facetted_pos_scales.html">facetted_pos_scales</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu">scale_x_log10</span>()))</pre></body></html></div>
<p><img src="Facets_files/figure-html/unnamed-chunk-6-1.png" width="288"><img src="Facets_files/figure-html/unnamed-chunk-6-2.png" width="288"></p>
</div>
<div id="sizes" class="section level1">
<h1 class="hasAnchor">
<a href="#sizes" class="anchor"></a>Sizes</h1>
<p>Lastly, we can also set the sizes of the panels to what we want. This can be especially convenient when you want different sizes for facets, for example when you want to add a density next to your plot. The function <code><a href="../reference/force_panelsizes.html">force_panelsizes()</a></code> can let you set relative or absolute sizes for the rows and columns.</p>
<p>The settings overrule the coordinates’ or theme’s aspect ratio and <code>space = "free"</code> facet arguments. By default, rows and columns are set relative within themselves only. When <code>respect = TRUE</code>, the rows and columns relative units become also relative between rows and columns, as you can see in the plot below. Alternatively, you can set them as absolute units with the <code><a href="https://rdrr.io/r/grid/unit.html">grid::unit()</a></code> function. Again, these need to be added <em>after</em> any facets.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">g</span> <span class="kw">&lt;-</span> <span class="fu">ggplot</span>(<span class="no">faithful</span>) +
  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="no">waiting</span>, <span class="no">eruptions</span>),
             <span class="kw">data</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">faithful</span>, <span class="kw">facet</span> <span class="kw">=</span> <span class="st">"Points"</span>)) +
  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="kw">y</span> <span class="kw">=</span> <span class="no">eruptions</span>),
               <span class="kw">data</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">faithful</span>, <span class="kw">facet</span> <span class="kw">=</span> <span class="st">"Density"</span>)) +
  <span class="fu">facet_grid</span>(~ <span class="no">facet</span>, <span class="kw">scales</span> <span class="kw">=</span> <span class="st">"free_x"</span>) +
  <span class="fu"><a href="../reference/force_panelsizes.html">force_panelsizes</a></span>(<span class="kw">cols</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">0.2</span>),
                   <span class="kw">rows</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.5</span>),
                   <span class="kw">respect</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">g</span></pre></body></html></div>
<p><img src="Facets_files/figure-html/unnamed-chunk-7-1.png" width="480"></p>
<p>If you think the breaks of the density plot above are too packed, why not tweak these with <code><a href="../reference/facetted_pos_scales.html">facetted_pos_scales()</a></code>? Note that <code>NULL</code> signals here that the default scale should be used.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">g</span> + <span class="fu"><a href="../reference/facetted_pos_scales.html">facetted_pos_scales</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">NULL</span>, <span class="fu">scale_x_continuous</span>(<span class="kw">breaks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>))))</pre></body></html></div>
<p><img src="Facets_files/figure-html/unnamed-chunk-8-1.png" width="480"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Teun van den Brand.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
