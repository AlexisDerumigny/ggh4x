<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Facets • ggh4x</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Facets">
<meta property="og:description" content="ggh4x">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ggh4x</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.2.1.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/ggh4x.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Facets.html">Facets</a>
    </li>
    <li>
      <a href="../articles/Miscellaneous.html">Miscellaneous</a>
    </li>
    <li>
      <a href="../articles/PositionGuides.html">Position Guides</a>
    </li>
    <li>
      <a href="../articles/Statistics.html">Statistics</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/teunbrand/ggh4x/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Facets_files/header-attrs-2.7/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Facets</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/teunbrand/ggh4x/blob/master/vignettes/Facets.Rmd"><code>vignettes/Facets.Rmd</code></a></small>
      <div class="hidden name"><code>Facets.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/teunbrand/ggh4x">ggh4x</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: ggplot2</span></code></pre></div>
<p>The ggh4x package has some extended options for tweaking the appearance of facets.</p>
<div id="extended-facets" class="section level1">
<h1 class="hasAnchor">
<a href="#extended-facets" class="anchor"></a>Extended facets</h1>
<p>This package offers two extensions to the vanilla <code>facet_wrap()</code> and <code>facet_grid()</code> that give you more control of the placement of axes at the inner facets.</p>
<div id="wrap" class="section level2">
<h2 class="hasAnchor">
<a href="#wrap" class="anchor"></a>Wrap</h2>
<p>The default behaviour of <code><a href="../reference/facet_wrap2.html">facet_wrap2()</a></code> is to replicate exactly what <code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">ggplot2::facet_wrap()</a></code> does.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Make a standard plot</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">mpg</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">displ</span>, <span class="va">hwy</span>, colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">cyl</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Engine displacement"</span>, y <span class="op">=</span> <span class="st">"Highway miles per gallon"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">guides</span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span>

<span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="../reference/facet_wrap2.html">facet_wrap2</a></span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">class</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="Facets_files/figure-html/wrap_mimick-1.png" width="480"></p>
<p>The difference is even when <code>scales = "fixed"</code> (the default), you can draw the axes at (some or all) inner facets with the <code>axes</code> argument. Moreover, you can choose to omit the axis labels but keep the axis ticks of the inner facets by setting the <code>remove_labels</code> argument.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="../reference/facet_wrap2.html">facet_wrap2</a></span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">class</span><span class="op">)</span>, axes <span class="op">=</span> <span class="st">"all"</span>, remove_labels <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span></code></pre></div>
<p><img src="Facets_files/figure-html/wrap_axes-1.png" width="480"></p>
<p>Another nicety is that you can force an exact number of rows and columns.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="../reference/facet_wrap2.html">facet_wrap2</a></span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">class</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">4</span>, ncol <span class="op">=</span> <span class="fl">4</span>, trim_blank <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p><img src="Facets_files/figure-html/wrap_trimming-1.png" width="480"></p>
</div>
<div id="grid" class="section level2">
<h2 class="hasAnchor">
<a href="#grid" class="anchor"></a>Grid</h2>
<p>Likewise, <code><a href="../reference/facet_grid2.html">facet_grid2()</a></code> is based on <code><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">ggplot2::facet_grid()</a></code> and by default behaves identically, but also supports the extended options for axes that <code><a href="../reference/facet_wrap2.html">facet_wrap2()</a></code> has.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="../reference/facet_grid2.html">facet_grid2</a></span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">year</span><span class="op">)</span>, <span class="fu">vars</span><span class="op">(</span><span class="va">drv</span><span class="op">)</span>, axes <span class="op">=</span> <span class="st">"all"</span>, remove_labels <span class="op">=</span> <span class="st">"y"</span><span class="op">)</span></code></pre></div>
<p><img src="Facets_files/figure-html/grid_axes-1.png" width="480"></p>
<p>In addition, <code><a href="../reference/facet_grid2.html">facet_grid2()</a></code> also supports what the package calls ‘independent’ scales. This relieves the constraint that <code><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">ggplot2::facet_grid()</a></code> has that a scale can only be free between rows and columns of the layout, and instead allows scales to be free within rows and columns of the layout. This keeps the grid layout but preserves the flexibility of scales in wrapped facets. Notice that in the plot below, the x-axes are independent for each panel.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="../reference/facet_grid2.html">facet_grid2</a></span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">year</span><span class="op">)</span>, <span class="fu">vars</span><span class="op">(</span><span class="va">drv</span><span class="op">)</span>, scales <span class="op">=</span> <span class="st">"free_x"</span>, independent <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span></code></pre></div>
<p><img src="Facets_files/figure-html/grid_independent-1.png" width="480"></p>
<p>One sacrifice that had to be made for independent scales, is that <code><a href="../reference/facet_grid2.html">facet_grid2()</a></code> cannot have independent scales <em>and</em> have <code>space = "free"</code> for the independent dimensions. You can however combine these in <em>different</em> dimensions.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="../reference/facet_grid2.html">facet_grid2</a></span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">year</span><span class="op">)</span>, <span class="fu">vars</span><span class="op">(</span><span class="va">drv</span><span class="op">)</span>, 
                scales <span class="op">=</span> <span class="st">"free"</span>, independent <span class="op">=</span> <span class="st">"y"</span>, space <span class="op">=</span> <span class="st">"free_x"</span><span class="op">)</span></code></pre></div>
<p><img src="Facets_files/figure-html/grid_independent_space-1.png" width="480"></p>
</div>
</div>
<div id="nested_facets" class="section level1">
<h1 class="hasAnchor">
<a href="#nested_facets" class="anchor"></a>Nested facets</h1>
<p>Perhaps this package might be best known for generating nested facets; wherein outer strips can span inner strips if they belong the the same category. This can be especially useful if there is some hierarchical relations to the facets.</p>
<p>In the example below, we’ll categorise the Iris species for having long or short leaves.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">new_iris</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html">transform</a></span><span class="op">(</span>
  <span class="va">iris</span>, 
  Nester <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">==</span> <span class="st">"setosa"</span>, <span class="st">"Short Leaves"</span>, <span class="st">"Long Leaves"</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">iris_plot</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">new_iris</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">Sepal.Width</span>, <span class="va">Sepal.Length</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span>

<span class="va">iris_plot</span> <span class="op">+</span>
  <span class="fu"><a href="../reference/facet_nested.html">facet_nested</a></span><span class="op">(</span><span class="op">~</span> <span class="va">Nester</span> <span class="op">+</span> <span class="va">Species</span><span class="op">)</span></code></pre></div>
<p><img src="Facets_files/figure-html/nested_grid-1.png" width="480"></p>
<div id="nesting-lines" class="section level2">
<h2 class="hasAnchor">
<a href="#nesting-lines" class="anchor"></a>Nesting lines</h2>
<p>If you prefer your strips to have blank backgrounds, you could still indicate the hierarchical nature by setting <code>nest_line = elment_line()</code>. The appearance of the line is inherited from the theme element <code>ggh4x.facet.nestline</code>. In the example below, the nesting line is dotted because the given element has <code>linetype = 2</code>, but is also blue because it inherits from the theme element.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">iris_plot</span> <span class="op">+</span>
  <span class="fu"><a href="../reference/facet_nested.html">facet_nested</a></span><span class="op">(</span><span class="op">~</span> <span class="va">Nester</span> <span class="op">+</span> <span class="va">Species</span>, nest_line <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span>linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>strip.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
        ggh4x.facet.nestline <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="Facets_files/figure-html/nested_nesting_lines-1.png" width="480"></p>
</div>
<div id="relation-to-facet_grid" class="section level2">
<h2 class="hasAnchor">
<a href="#relation-to-facet_grid" class="anchor"></a>Relation to <code>facet_grid()</code>
</h2>
<p>While <code><a href="../reference/facet_nested.html">facet_nested()</a></code> is based on <code>facet_grid())</code>, there are a few differences. First, <code><a href="../reference/facet_nested.html">facet_nested()</a></code> inherits from <code><a href="../reference/facet_grid2.html">facet_grid2()</a></code>, so that it inherits the axis features. More notably, <code><a href="../reference/facet_nested.html">facet_nested()</a></code> doesn’t require input data to have <em>all</em> the facet variables. In the example below, we remove the <code>Species</code> column, to prevent facetting on that variable. Note that if we didn’t specify a new <code>Nester</code> variable, it would put the second set of points in all panels, just like <code>facet_grid()</code>.</p>
<p>Furthermore, when strips are placed at the bottom, it rearranges the strips so that the inner strips are closest to the panels and spanning strips are furthest from the panel.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">iris_plot</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span>data <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html">transform</a></span><span class="op">(</span><span class="va">.x</span>, Species <span class="op">=</span> <span class="cn">NULL</span>, Nester <span class="op">=</span> <span class="st">"All"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../reference/facet_nested.html">facet_nested</a></span><span class="op">(</span><span class="op">~</span> <span class="va">Nester</span> <span class="op">+</span> <span class="va">Species</span>, switch <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span></code></pre></div>
<p><img src="Facets_files/figure-html/nested_grid_difference-1.png" width="480"></p>
</div>
<div id="variant-for-facet_wrap" class="section level2">
<h2 class="hasAnchor">
<a href="#variant-for-facet_wrap" class="anchor"></a>Variant for <code>facet_wrap()</code>
</h2>
<p>A similar variant exists for wrapping in facets. It can span the strips for every <code>strip.position</code> argument, and has a few nifty tricks for duplicating the axes or just the axis ticks.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">+</span> 
  <span class="fu"><a href="../reference/facet_nested_wrap.html">facet_nested_wrap</a></span><span class="op">(</span>
    <span class="fu">vars</span><span class="op">(</span><span class="va">cyl</span>, <span class="va">drv</span><span class="op">)</span>, dir <span class="op">=</span> <span class="st">"v"</span>, strip.position <span class="op">=</span> <span class="st">"left"</span>,
    axes <span class="op">=</span> <span class="st">"all"</span>, remove_labels <span class="op">=</span> <span class="st">"x"</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>strip.placement <span class="op">=</span> <span class="st">"outside"</span><span class="op">)</span></code></pre></div>
<p><img src="Facets_files/figure-html/nested_wrap-1.png" width="480"></p>
<p>Please note that <code><a href="../reference/facet_nested_wrap.html">facet_nested_wrap()</a></code> does not change the underlying layout strategy of <code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">ggplot2::facet_wrap()</a></code>. It does <em>not</em> split sets to separate rows or columns. If you have need of this type of custom layout, read on what <code><a href="../reference/facet_manual.html">facet_manual()</a></code> can do!</p>
</div>
</div>
<div id="manual-facets" class="section level1">
<h1 class="hasAnchor">
<a href="#manual-facets" class="anchor"></a>Manual facets</h1>
<p>Before discussing manual facets, let me first explain the motivation behind it.</p>
<div id="the-base-r-layout-function" class="section level2">
<h2 class="hasAnchor">
<a href="#the-base-r-layout-function" class="anchor"></a>The base-R <code>layout()</code> function</h2>
<p>The ‘grid’ and ‘wrap’ layouts of facets are great because they dynamically adapt based on the available data. However, these layouts come with the limitation that every panel occupies a cell in a grid, and we lose some control over where data is drawn. A base R graphics equivalent to set-up multi-panel figures is the <code><a href="https://rdrr.io/r/graphics/layout.html">layout()</a></code> function. A neat property of this function is that a single plot can occupy more than one cell in a grid.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Setting up a design for a layout</span>
<span class="va">design</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">2</span><span class="op">)</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/layout.html">layout</a></span><span class="op">(</span><span class="va">design</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Making a multi-panel plot based on the layout</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="va">mpg</span>
<span class="va">df</span><span class="op">$</span><span class="va">colours</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">cyl</span>, <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">cyl</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">df</span><span class="op">$</span><span class="va">colours</span> <span class="op">&lt;-</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/hue_pal.html">hue_pal</a></span><span class="op">(</span><span class="op">)</span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">colours</span><span class="op">]</span>
<span class="va">splitted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">df</span><span class="op">$</span><span class="va">drv</span><span class="op">)</span>
<span class="va">xlim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">displ</span><span class="op">)</span>
<span class="va">ylim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">cty</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">splitted</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">splitted</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">displ</span>, <span class="va">cty</span>, col <span class="op">=</span> <span class="va">colours</span>, pch <span class="op">=</span> <span class="fl">19</span>,
                           xlim <span class="op">=</span> <span class="va">xlim</span>, ylim <span class="op">=</span> <span class="va">ylim</span>, <span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p><img src="Facets_files/figure-html/base_layout-1.png" width="480"></p>
</div>
<div id="the-design-argument" class="section level2">
<h2 class="hasAnchor">
<a href="#the-design-argument" class="anchor"></a>The design argument</h2>
<p>To achieve a similar level of control over ggplot2 facets, <code><a href="../reference/facet_manual.html">facet_manual()</a></code> was brought into life. Like the <code><a href="https://rdrr.io/r/graphics/layout.html">layout()</a></code> function, <code><a href="../reference/facet_manual.html">facet_manual()</a></code> requires a pre-specified design of which panels go where. I’ve called these ‘manual’ facets, because it doesn’t dynamically generate a layout based on the available data, like the grid and wrap facets do. The matrix that we had given to the <code><a href="https://rdrr.io/r/graphics/layout.html">layout()</a></code> function in the plots above, can now be used as the <code>design</code> argument for the manual facets.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Use design from previous chunk</span>
<span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="../reference/facet_manual.html">facet_manual</a></span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">drv</span><span class="op">)</span><span class="op">)</span>, design <span class="op">=</span> <span class="va">design</span><span class="op">)</span></code></pre></div>
<p><img src="Facets_files/figure-html/facet_manual-1.png" width="480"></p>
<p>An alternative way of specifying the design is using a character string. The approach to this was inspired by the <code>design</code> argument in the <code><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html">patchwork::plot_layout()</a></code> function that lets you set columns by using subsequent characters, and set rows by using new lines. Empty cells can be indicated with the <code>#</code>-sign.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">design</span> <span class="op">&lt;-</span> <span class="st">"
  A##
  AB#
  #BC
  ##C
"</span>
<span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="../reference/facet_manual.html">facet_manual</a></span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">drv</span><span class="op">)</span>, design <span class="op">=</span> <span class="va">design</span><span class="op">)</span></code></pre></div>
<p><img src="Facets_files/figure-html/facet_manual_chardesign-1.png" width="480"></p>
</div>
<div id="placement-rules" class="section level2">
<h2 class="hasAnchor">
<a href="#placement-rules" class="anchor"></a>Placement rules</h2>
<p>The <code><a href="../reference/facet_manual.html">facet_manual()</a></code> function has the <code>heights</code> and <code>widths</code> arguments that can be used to set the sizes of rows and columns of the design. In the example below, we’re using integers for the <code>heights</code> argument to specify relative sizes and <code><a href="https://rdrr.io/r/grid/unit.html">grid::unit</a></code>s for the <code>widths</code> argument to set absolute sizes. These arguments apply to the cells where the panels are drawn. Therefore, the eventual size of a multi-cell panel is likely not the exact sum of cell sizes, because <code><a href="../reference/facet_manual.html">facet_manual()</a></code> makes room for plot decorations like strips and axes. In the example below, the height of the 4 wheel drive (4) panel is not exactly 3 + 2 = 5 relative units, due to the room that had to be made to fit the x-axis of the front-wheel drive (f) panel and the strip of the rear-wheel drive (r) panel.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="../reference/facet_manual.html">facet_manual</a></span><span class="op">(</span>
  <span class="fu">vars</span><span class="op">(</span><span class="va">drv</span><span class="op">)</span>, design <span class="op">=</span> <span class="va">design</span>,
  heights <span class="op">=</span> <span class="fl">4</span><span class="op">:</span><span class="fl">1</span>, widths <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="st">"cm"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p><img src="Facets_files/figure-html/facet_manual_sizes-1.png" width="480"></p>
<p>The panels above all share the same axes ranges, but because these are drawn in a staggered fashion they should all be displayed. Because there are only limited constraints of where axes can be placed, it is hard to decide what duplicated axes are OK to omit. The manual facets are not ‘smart’ enough to figure this out exactly and just draw the axes for every panel, regardless of whether they are fixed or free. The only exception to this rule, is when all panel occupies <em>exactly</em> 1 cell in the horizontal or vertical direction. Because of this, the <code>remove_labels</code> and <code>axes</code> arguments are trickier to use for <code><a href="../reference/facet_manual.html">facet_manual()</a></code>, and may only be applied when the criterion above is met.</p>
</div>
<div id="a-word-of-warning" class="section level2">
<h2 class="hasAnchor">
<a href="#a-word-of-warning" class="anchor"></a>A word of warning</h2>
<p>The manual facets are ‘dumb’ in the sense that they don’t protect you against ‘illegal’ layouts. If you specify non-rectangular areas in the <code>design</code> argument, it will simply calculate the range of rows and columns a panel will occupy, which can lead to (partially) overlapping panels. It is up to the user to decide what is right in these cases and the facets are not prohibitive.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">design</span> <span class="op">&lt;-</span> <span class="st">"
  AA#
  ACB
  #BB
"</span>
<span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="../reference/facet_manual.html">facet_manual</a></span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">drv</span><span class="op">)</span>, design <span class="op">=</span> <span class="va">design</span><span class="op">)</span></code></pre></div>
<p><img src="Facets_files/figure-html/facet_manual_invalid-1.png" width="480"></p>
</div>
</div>
<div id="strips" class="section level1">
<h1 class="hasAnchor">
<a href="#strips" class="anchor"></a>Strips</h1>
<p>Strips are an important part of facets because they indicate what small multiple of data is displayed where. In ggplot2, strips are married to the facet functions, which control what is rendered how and where they are placed. For facet functions in ggh4x, strips are divorced from facets and strips are allowed to decide how they are rendered and where they are placed. All ggh4x facetting functions have gained the <code>strip</code> argument that take a new <code>Strip</code> class that can constructed with the <code>strip_*()</code> family of functions.</p>
<div id="vanilla-strips" class="section level2">
<h2 class="hasAnchor">
<a href="#vanilla-strips" class="anchor"></a>Vanilla strips</h2>
<p>A style of strips that most closely resembles strips in ggplot2 are vanilla strips that can be constructed using the <code><a href="../reference/strip_vanilla.html">strip_vanilla()</a></code> function. It is the default strip for <code><a href="../reference/facet_grid2.html">facet_grid2()</a></code>, <code><a href="../reference/facet_wrap2.html">facet_wrap2()</a></code> and <code><a href="../reference/facet_manual.html">facet_manual()</a></code>. Their behaviour mirrors the behaviour of ggplot2’s strips by default, but they come with two extra arguments.</p>
<p>The <code>clip</code> argument controls whether the content of the strip is clipped to the boundaries of the strip background. When clipping is on (the default), any line-width applied to the strip background is effectively halved in size and near impossible to get nicely aligned with, for example, axis lines. When clipping is off, the strip backgrounds have their full line-widths, and strip text is allowed to exceed the confines of the background.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>strip.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,
        axis.line.y <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span>

<span class="va">p2</span> <span class="op">+</span> <span class="fu"><a href="../reference/facet_wrap2.html">facet_wrap2</a></span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">year</span><span class="op">)</span>, strip <span class="op">=</span> <span class="fu"><a href="../reference/strip_vanilla.html">strip_vanilla</a></span><span class="op">(</span>clip <span class="op">=</span> <span class="st">"on"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">'clip = "on"'</span><span class="op">)</span>

<span class="va">p2</span> <span class="op">+</span> <span class="fu"><a href="../reference/facet_wrap2.html">facet_wrap2</a></span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">year</span><span class="op">)</span>, strip <span class="op">=</span> <span class="fu"><a href="../reference/strip_vanilla.html">strip_vanilla</a></span><span class="op">(</span>clip <span class="op">=</span> <span class="st">"off"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">'clip = "off"'</span><span class="op">)</span></code></pre></div>
<p><img src="Facets_files/figure-html/strip_clip-1.png" width="288"><img src="Facets_files/figure-html/strip_clip-2.png" width="288"></p>
<p>The second argument, <code>size</code>, controls how the size of strips are calculated in the context of multi-layered strips. The default, <code>"constant"</code>, calculates a single size for every layer. Normally, this makes everything looks tidy, but can become awkward when longer labels are combined with shorter labels.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
  long <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"A long title that is going to make the\n"</span>,
               <span class="st">"smaller title take up too much space"</span><span class="op">)</span>,
  short <span class="op">=</span> <span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>,
  x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, y <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>
<span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">df</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>strip.text.y.left <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,
        strip.placement <span class="op">=</span> <span class="st">"outside"</span>,
        plot.title.position <span class="op">=</span> <span class="st">"plot"</span><span class="op">)</span>

<span class="va">p2</span> <span class="op">+</span> <span class="fu"><a href="../reference/facet_grid2.html">facet_grid2</a></span><span class="op">(</span><span class="va">long</span> <span class="op">+</span> <span class="va">short</span> <span class="op">~</span> <span class="va">.</span>, switch <span class="op">=</span> <span class="st">"y"</span>,
                strip <span class="op">=</span> <span class="fu"><a href="../reference/strip_vanilla.html">strip_vanilla</a></span><span class="op">(</span>size <span class="op">=</span> <span class="st">"constant"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">'size = "constant"'</span><span class="op">)</span></code></pre></div>
<p><img src="Facets_files/figure-html/strip_size_constant-1.png" width="480"></p>
<p>Setting <code>size = "variable"</code> instead shrinks excessive spacing from strips on a per-layer basis.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p2</span> <span class="op">+</span> <span class="fu"><a href="../reference/facet_grid2.html">facet_grid2</a></span><span class="op">(</span><span class="va">long</span> <span class="op">+</span> <span class="va">short</span> <span class="op">~</span> <span class="va">.</span>, switch <span class="op">=</span> <span class="st">"y"</span>,
                strip <span class="op">=</span> <span class="fu"><a href="../reference/strip_vanilla.html">strip_vanilla</a></span><span class="op">(</span>size <span class="op">=</span> <span class="st">"variable"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">'size = "variable"'</span><span class="op">)</span></code></pre></div>
<p><img src="Facets_files/figure-html/strip_size_variable-1.png" width="480"></p>
</div>
<div id="themed-strips" class="section level2">
<h2 class="hasAnchor">
<a href="#themed-strips" class="anchor"></a>Themed strips</h2>
<p>An extension of the vanilla strips is themed strips. In addition to the <code>clip</code> and <code>size</code> arguments, these strips allow you to set the <code>strip.text.*</code> and <code>strip.background.*</code> theme settings on a per-label or per-layer basis. The <code>background_x/y</code> and <code>text_x/y</code> arguments accept a list of ggplot2 theme elements. If the number of theme elements does not fit the number of strips, the theme elements will be expanded with <code><a href="https://rdrr.io/r/base/rep.html">rep_len()</a></code> as shown with the vertical strips below.</p>
<p>It can be a bit of a pain to construct a list of elements per the following: <code>list(element_text(colour = "dodgerblue", face = "bold), element_text(colour = "limegreen", face = "bold))</code>. Instead, there are convenience functions that let you get the exact same results by using <code><a href="../reference/distribute_args.html">elem_list_text(colour = c("dodgerblue", "limegreen"), face = c("bold", "bold"))</a></code>, which is slightly less verbose. There is also a <code><a href="../reference/distribute_args.html">elem_list_rect()</a></code> function to do the same for <code>element_rect()</code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ridiculous_strips</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/strip_themed.html">strip_themed</a></span><span class="op">(</span>
     <span class="co"># Horizontal strips</span>
     background_x <span class="op">=</span> <span class="fu"><a href="../reference/distribute_args.html">elem_list_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"limegreen"</span>, <span class="st">"dodgerblue"</span><span class="op">)</span><span class="op">)</span>,
     text_x <span class="op">=</span> <span class="fu"><a href="../reference/distribute_args.html">elem_list_text</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"dodgerblue"</span>, <span class="st">"limegreen"</span><span class="op">)</span>,
                             face <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"bold"</span>, <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span>,
     by_layer_x <span class="op">=</span> <span class="cn">TRUE</span>,
     <span class="co"># Vertical strips</span>
     background_y <span class="op">=</span> <span class="fu"><a href="../reference/distribute_args.html">elem_list_rect</a></span><span class="op">(</span>
       fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"gold"</span>, <span class="st">"tomato"</span>, <span class="st">"deepskyblue"</span><span class="op">)</span>
     <span class="op">)</span>,
     text_y <span class="op">=</span> <span class="fu"><a href="../reference/distribute_args.html">elem_list_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">90</span><span class="op">)</span><span class="op">)</span>,
     by_layer_y <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span>

<span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="../reference/facet_grid2.html">facet_grid2</a></span><span class="op">(</span><span class="va">class</span> <span class="op">~</span> <span class="va">drv</span> <span class="op">+</span> <span class="va">year</span>, strip <span class="op">=</span> <span class="va">ridiculous_strips</span><span class="op">)</span></code></pre></div>
<p><img src="Facets_files/figure-html/strip_themed-1.png" width="480"></p>
<p>The list of elements does not need to be a homogeneous list of the same type of elements. You can use <code>NULL</code> to inherit directly from the theme, and <code>element_blank()</code> to skip drawing the element. The themed strips should <em>in theory</em> also accept extended theme elements -it accepts for example <code><a href="https://wilkelab.org/ggtext/reference/element_markdown.html">ggtext::element_markdown()</a></code>- provided that the implementation has a <code>element_grob()</code> method and the resulting graphical objects communicate their size appropriately. The constraints are similar to the constraints in <code>theme()</code>: text elements should inherit from <code>element_text</code> and background elements should inherit from <code>element_rect</code>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="../reference/facet_grid2.html">facet_grid2</a></span><span class="op">(</span>
   <span class="va">.</span> <span class="op">~</span> <span class="va">drv</span> <span class="op">+</span> <span class="va">year</span>,
   strip <span class="op">=</span> <span class="fu"><a href="../reference/strip_themed.html">strip_themed</a></span><span class="op">(</span>
     background_x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="fu">element_rect</span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>, <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
                         <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span>,
     text_x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="cn">NULL</span>, <span class="cn">NULL</span>, <span class="fu">element_text</span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span><span class="op">)</span>
   <span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p><img src="Facets_files/figure-html/strip_themed_mix-1.png" width="480"></p>
</div>
<div id="nested-strips" class="section level2">
<h2 class="hasAnchor">
<a href="#nested-strips" class="anchor"></a>Nested strips</h2>
<p>The crux of nested strips has already been introduced in <a href="#nested_facets">nested_facets</a>: they merge strips that have the same labels at the same height. They are the default strips in <code><a href="../reference/facet_nested.html">facet_nested()</a></code> and <code><a href="../reference/facet_nested_wrap.html">facet_nested_wrap()</a></code> and they are constructed using <code><a href="../reference/strip_nested.html">strip_nested()</a></code>. There is nothing special that makes these facets more suitable for strips, and you can use nested strips in <code><a href="../reference/facet_grid2.html">facet_grid2()</a></code>, <code><a href="../reference/facet_wrap2.html">facet_wrap2()</a></code> and <code><a href="../reference/facet_manual.html">facet_manual()</a></code> too. Because the nested strips are based on <code><a href="../reference/strip_themed.html">strip_themed()</a></code>, the appearance of strips can be tweaked in the same way. The nested strips only have one extra argument, <code>bleed</code>, that controls whether lower layer nested strips are allowed to merge when higher layer nested strips are different. In the example below, you can see in the 2nd and 3rd panels that the two “f” labels aren’t merged because higher strips are different (“4”and “5”).</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="../reference/facet_wrap2.html">facet_wrap2</a></span><span class="op">(</span>
  <span class="fu">vars</span><span class="op">(</span><span class="va">cyl</span>, <span class="va">drv</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">4</span>,
  strip <span class="op">=</span> <span class="fu"><a href="../reference/strip_nested.html">strip_nested</a></span><span class="op">(</span>bleed <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">'bleed = FALSE'</span><span class="op">)</span></code></pre></div>
<p><img src="Facets_files/figure-html/strip_nested-1.png" width="480"></p>
<p>In contrast, when <code>bleed = TRUE</code>, lower layer strips are allowed to ‘bleed’ into one another even though the higher level strips are different. In the example below, you can see that the “f” strips of the 2nd and 3rd panel have merged, even though they have different labels (“4” and “5”) in higher layer strips.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="../reference/facet_wrap2.html">facet_wrap2</a></span><span class="op">(</span>
  <span class="fu">vars</span><span class="op">(</span><span class="va">cyl</span>, <span class="va">drv</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">4</span>,
  strip <span class="op">=</span> <span class="fu"><a href="../reference/strip_nested.html">strip_nested</a></span><span class="op">(</span>bleed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"bleed = TRUE"</span><span class="op">)</span></code></pre></div>
<p><img src="Facets_files/figure-html/strip_bleed-1.png" width="480"></p>
<p>Another difference between <code><a href="../reference/strip_nested.html">strip_nested()</a></code> and other strips, is that the ordering of the layers is always such that the inner layers are closer to the panels than the outer layers. It felt like the right decision because if we’re trying to distinguish hierarchies, it sense to place the more fine-grained hierarchy closer to the data that is a member of that hierarchy.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="../reference/facet_grid2.html">facet_grid2</a></span><span class="op">(</span>
  cols <span class="op">=</span> <span class="fu">vars</span><span class="op">(</span><span class="st">"Outer label"</span>, <span class="st">"Inner label"</span><span class="op">)</span>,
  switch <span class="op">=</span> <span class="st">"x"</span>, strip <span class="op">=</span> <span class="fu"><a href="../reference/strip_vanilla.html">strip_vanilla</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"strip_vanilla()"</span><span class="op">)</span>

<span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="../reference/facet_grid2.html">facet_grid2</a></span><span class="op">(</span>
  cols <span class="op">=</span> <span class="fu">vars</span><span class="op">(</span><span class="st">"Outer label"</span>, <span class="st">"Inner label"</span><span class="op">)</span>,
  switch <span class="op">=</span> <span class="st">"x"</span>, strip <span class="op">=</span> <span class="fu"><a href="../reference/strip_nested.html">strip_nested</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"strip_nested()"</span><span class="op">)</span></code></pre></div>
<p><img src="Facets_files/figure-html/strip_nested_bottom-1.png" width="288"><img src="Facets_files/figure-html/strip_nested_bottom-2.png" width="288"></p>
</div>
</div>
<div id="position-scales" class="section level1">
<h1 class="hasAnchor">
<a href="#position-scales" class="anchor"></a>Position scales</h1>
<p>Another thing we might want to tweak about facets is the exact specifications of each facet’s position scale. To set the scales individually, we can use <code><a href="../reference/facetted_pos_scales.html">facetted_pos_scales()</a></code> in combination with a list of scales. This way, you can vary labels, breaks, limits, transformations and even axis guides for each panel individually.</p>
<div id="lists-of-scales" class="section level2">
<h2 class="hasAnchor">
<a href="#lists-of-scales" class="anchor"></a>Lists of scales</h2>
<p>The list of scales follows the order of the facets, as long as they are set to ‘free’. Tweaking the position scales works with many types of facets, such as wrap, grid and nested, but has to be called <em>after</em> facets are added. If you don’t want the scales to be free, you can use the <code><a href="https://rdrr.io/r/graphics/plot.window.html">xlim()</a></code> and <code><a href="https://rdrr.io/r/graphics/plot.window.html">ylim()</a></code> functions to fix the limits, but the <code><a href="../reference/facetted_pos_scales.html">facetted_pos_scales()</a></code> function requires the <code>scales</code> argument in a facet to be <code>"free"</code> in order to apply the different scales.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">scales</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="fu">scale_x_reverse</span><span class="op">(</span><span class="op">)</span>,
  <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/label_dollar.html">dollar</a></span>,
                     minor_breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2.5</span>, <span class="fl">4.5</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2.945</span>, <span class="fl">6</span><span class="op">)</span>,
                     limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span>,
                     guide <span class="op">=</span> <span class="st">"axis_minor"</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">p</span> <span class="op">+</span> <span class="fu">facet_wrap</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">drv</span><span class="op">)</span>, scales <span class="op">=</span> <span class="st">"free_x"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../reference/facetted_pos_scales.html">facetted_pos_scales</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">scales</span><span class="op">)</span></code></pre></div>
<p><img src="Facets_files/figure-html/position_scales_list-1.png" width="480"></p>
</div>
<div id="formula-notation" class="section level2">
<h2 class="hasAnchor">
<a href="#formula-notation" class="anchor"></a>Formula notation</h2>
<p>Because it might be inconvenient to predict in programmatically which data might end up in what position, there is also an option to use two-sided formulas to set scales by panel. The formula notation is inspired by <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">dplyr::case_when()</a></code> and lets you use the left hand side (LHS) to decide <em>where</em> to apply scales, and the right hand side (RHS) to decide <em>what</em> scales to apply. The LHS of the formula will be evaluated in the context of the plot’s layout. This is an internal structure that (for good reasons) isn’t normally exposed, so it requires a bit of knowledge to know what can be used. For most facets, the plot layout is a <code>data.frame</code> that contains the <code>COL</code>, <code>ROW</code> and <code>PANEL</code> columns that keep track of what panel goes where in the grid of cells. In addition, it contains the faceting variables, such as <code>class</code> in the example below.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">class</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">1</span>, scales <span class="op">=</span> <span class="st">"free_x"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">xlim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">mpg</span><span class="op">$</span><span class="va">displ</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../reference/facetted_pos_scales.html">facetted_pos_scales</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    <span class="va">COL</span> <span class="op">%%</span> <span class="fl">2</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">~</span> <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="cn">NULL</span>, limits <span class="op">=</span> <span class="va">xlim</span><span class="op">)</span>,
    <span class="va">class</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"midsize"</span>, <span class="st">"suv"</span>, <span class="st">"subcompact"</span><span class="op">)</span> <span class="op">~</span> <span class="fu">scale_x_continuous</span><span class="op">(</span>
      guide <span class="op">=</span> <span class="fu"><a href="../reference/guide_axis_truncated.html">guide_axis_colour</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>, limits <span class="op">=</span> <span class="va">xlim</span>
    <span class="op">)</span>
  <span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="Facets_files/figure-html/position_scales_formula-1.png" width="480"></p>
<p>In the example above, we removed the label from every even column by using <code>COL %% 2 == 0</code>, wherein <code>COL</code> is a column in the aforementioned layout structure. We also made the axes of the <code>"midsize"</code> and <code>"suv"</code> classes red. The reason we don’t see red axis ticks in the <code>"subcompact"</code> panel is that applying scales is prioritised based on the order of formulas. Because the <code>"subcompact"</code> panel is also on an even column, and the ‘even columns have no labels’-formula was first, it gets excluded from the second formula.</p>
</div>
<div id="interaction-with-stats" class="section level2">
<h2 class="hasAnchor">
<a href="#interaction-with-stats" class="anchor"></a>Interaction with stats</h2>
<p>The <code><a href="../reference/facetted_pos_scales.html">facetted_pos_scales()</a></code> works because it makes an edit to the facet, which comes with an important limitation. Due to the way plots are build and <em>when</em> facets are involved, scale transformations are applied <em>after</em> calculations in the stat part of the layer. This differs from normal behaviour, where scale transformations are applied <em>before</em> stat calculations. Therefore, it is recommended to pre-transform the data in layers with non-identity statistics in the <code>aes()</code> mapping. An example of what could go wrong is shown below.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html">rlnorm</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">10</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># Normally data is transformed prior to stat calculations</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">df</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_density</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_x_log10</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"standard log10 scale"</span><span class="op">)</span>

<span class="co"># This can give problems when combining stat calculations with facetted </span>
<span class="co"># position scale transformations.</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">df</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_density</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../reference/facetted_pos_scales.html">facetted_pos_scales</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu">scale_x_log10</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"facetted scale"</span><span class="op">)</span>

<span class="co"># Pre-transformed data</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">df</span>, <span class="fu">aes</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_density</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../reference/facetted_pos_scales.html">facetted_pos_scales</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu">scale_x_continuous</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"facetted scale +\npre-transformation"</span><span class="op">)</span></code></pre></div>
<p><img src="Facets_files/figure-html/position_scales_stats-1.png" width="288"><img src="Facets_files/figure-html/position_scales_stats-2.png" width="288"><img src="Facets_files/figure-html/position_scales_stats-3.png" width="288"></p>
<p>If you plan on using <code><a href="../reference/facetted_pos_scales.html">facetted_pos_scales()</a></code> to tweak the axis of the plots, do take a look at the <a href="PositionGuides.html">position guides</a>!</p>
</div>
</div>
<div id="panel-sizes" class="section level1">
<h1 class="hasAnchor">
<a href="#panel-sizes" class="anchor"></a>Panel sizes</h1>
<p>Lastly, we can also set the sizes of the panels to what we want. This can be especially convenient when you want different sizes for facets, for example when you want to add a density next to your plot. The function <code><a href="../reference/force_panelsizes.html">force_panelsizes()</a></code> can let you set relative or absolute sizes for the rows and columns. The function should be applicable to facets that follow typical ggplot2 conventions. That includes, but is not limited to, the facet functions in ‘ggplot2’, those in the ‘ggforce’ package, those in ‘ggh4x’ and possibly others (it’s redundant for <code><a href="../reference/facet_manual.html">facet_manual()</a></code> though).</p>
<p>The settings overrule the coordinates’ or theme’s aspect ratio and <code>space = "free"</code> facet arguments. By default, rows and columns are set relative within themselves only. When <code>respect = TRUE</code>, the rows and columns relative units become also relative between rows and columns, as you can see in the plot below. Alternatively, you can set them as absolute units with the <code><a href="https://rdrr.io/r/grid/unit.html">grid::unit()</a></code> function. Again, these need to be added <em>after</em> any facets.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lvls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Points"</span>, <span class="st">"Density"</span><span class="op">)</span>
<span class="va">g</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">faithful</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">waiting</span>, <span class="va">eruptions</span><span class="op">)</span>,
             data <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">.x</span>, facet <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">lvls</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">lvls</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_density</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">eruptions</span><span class="op">)</span>,
               data <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">faithful</span>, facet <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">lvls</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">lvls</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_grid</span><span class="op">(</span><span class="op">~</span> <span class="va">facet</span>, scales <span class="op">=</span> <span class="st">"free_x"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../reference/force_panelsizes.html">force_panelsizes</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.2</span><span class="op">)</span>, 
                   rows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>,
                   respect <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">g</span></code></pre></div>
<p><img src="Facets_files/figure-html/panel_sizes-1.png" width="480"></p>
<p>If you think the breaks of the density plot above are too packed, why not tweak these with <code><a href="../reference/facetted_pos_scales.html">facetted_pos_scales()</a></code>? Note that <code>NULL</code> signals here that the default scale should be used.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">g</span> <span class="op">+</span> <span class="fu"><a href="../reference/facetted_pos_scales.html">facetted_pos_scales</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="Facets_files/figure-html/panel_sizes_2-1.png" width="480"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Teun van den Brand.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
